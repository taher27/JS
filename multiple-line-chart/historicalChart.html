<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>Issues Ratings</title>
<style>

body {
  font: 10px sans-serif;
}

.axis path,
.axis line, 
.axis1 path,
.axis1 line {
  fill: none;
  stroke: #E6E7E8;
  shape-rendering: crispEdges;
}

.x.axis path, .x.axis1 path {
  display: none;
}

.line {
  fill: none;
  stroke-width: 1.5px;
}

.legend-box {
  cursor: pointer;  
}

#mouse-tracker {
  stroke: #E6E7E8;
  stroke-width: 1px;
}

.hover-line { 
  stroke: #E6E7E8;
  fill: none;
  stroke-width: 1px;
  left: 10px;
  shape-rendering: crispEdges;
  opacity: 1e-6;
}

.hover-text {
  stroke: none;
  font-size: 30px;
  font-weight: bold;
  fill: #000000;
}

.tooltip {
  font-weight: normal;
}

.brush .extent {
  stroke: #FFF;
  shape-rendering: crispEdges;
}

</style>
</head>
<body>
<script src="https://d3js.org/d3.v3.js"></script>
<script>

var margin = {top: 20, right: 200, bottom: 100, left: 50},
    margin2 = { top: 430, right: 10, bottom: 20, left: 40 },
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom,
    height2 = 500 - margin2.top - margin2.bottom;

var parseDate = d3.time.format("%Y%m%d").parse;
var bisectDate = d3.bisector(function(d) { return d.date; }).left;

var xScale = d3.time.scale()
    .range([0, width]),

    xScale2 = d3.time.scale()
    .range([0, width]); // Duplicate xScale for brushing ref later

var yScale = d3.scale.linear()
    .range([height, 0]);

// 40 Custom DDV colors 
var color = d3.scale.ordinal().range(["#48A36D",  "#56AE7C",  "#64B98C", "#72C39B", "#80CEAA", "#80CCB3", "#7FC9BD", "#7FC7C6", "#7EC4CF", "#7FBBCF", "#7FB1CF", "#80A8CE", "#809ECE", "#8897CE", "#8F90CD", "#9788CD", "#9E81CC", "#AA81C5", "#B681BE", "#C280B7", "#CE80B0", "#D3779F", "#D76D8F", "#DC647E", "#E05A6D", "#E16167", "#E26962", "#E2705C", "#E37756", "#E38457", "#E39158", "#E29D58", "#E2AA59", "#E0B15B", "#DFB95C", "#DDC05E", "#DBC75F", "#E3CF6D", "#EAD67C", "#F2DE8A"]);  


var xAxis = d3.svg.axis()
    .scale(xScale)
    .orient("bottom"),

    xAxis2 = d3.svg.axis() // xAxis for brush slider
    .scale(xScale2)
    .orient("bottom");    

var yAxis = d3.svg.axis()
    .scale(yScale)
    .orient("left");  

var line = d3.svg.line()
    .interpolate("basis")
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.rating); })
    .defined(function(d) { return d.rating; });  // Hiding line value defaults of 0 for missing data

var maxY; // Defined later to update yAxis

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom) //height + margin.top + margin.bottom
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
var data = [
    {
        "tags": {
            "__name__": "zbio_podcpu",
            "ns": "zbio",
            "pod": "zbio-broker-group1-1"
        },
        "metrics": [
            {
                "timestamp": 1589599920000,
                "value": 305027
            },
            {
                "timestamp": 1589600040000,
                "value": 305027
            },
            {
                "timestamp": 1589600160000,
                "value": 2480
            },
            {
                "timestamp": 1589600280000,
                "value": 2480
            },
            {
                "timestamp": 1589600400000,
                "value": 2480
            },
            {
                "timestamp": 1589600640000,
                "value": 2812
            },
            {
                "timestamp": 1589600760000,
                "value": 2812
            },
            {
                "timestamp": 1589600880000,
                "value": 2812
            },
            {
                "timestamp": 1589601000000,
                "value": 8322
            },
            {
                "timestamp": 1589601120000,
                "value": 8322
            },
            {
                "timestamp": 1589601240000,
                "value": 3566
            },
            {
                "timestamp": 1589601360000,
                "value": 3566
            },
            {
                "timestamp": 1589601480000,
                "value": 3566
            },
            {
                "timestamp": 1589601600000,
                "value": 74070
            },
            {
                "timestamp": 1589601720000,
                "value": 74070
            },
            {
                "timestamp": 1589601840000,
                "value": 3822
            },
            {
                "timestamp": 1589601960000,
                "value": 3822
            },
            {
                "timestamp": 1589602080000,
                "value": 3822
            },
            {
                "timestamp": 1589602200000,
                "value": 24593
            },
            {
                "timestamp": 1589602320000,
                "value": 24593
            },
            {
                "timestamp": 1589602440000,
                "value": 0
            },
            {
                "timestamp": 1589602560000,
                "value": 0
            },
            {
                "timestamp": 1589602680000,
                "value": 0
            },
            {
                "timestamp": 1589602800000,
                "value": 15917
            },
            {
                "timestamp": 1589602920000,
                "value": 15917
            },
            {
                "timestamp": 1589603040000,
                "value": 0
            },
            {
                "timestamp": 1589603160000,
                "value": 0
            },
            {
                "timestamp": 1589603280000,
                "value": 0
            },
            {
                "timestamp": 1589603880000,
                "value": 0
            },
            {
                "timestamp": 1589604000000,
                "value": 0
            },
            {
                "timestamp": 1589604120000,
                "value": 0
            },
            {
                "timestamp": 1589605080000,
                "value": 14136
            },
            {
                "timestamp": 1589605200000,
                "value": 14136
            },
            {
                "timestamp": 1589605320000,
                "value": 117691
            },
            {
                "timestamp": 1589605440000,
                "value": 117691
            },
            {
                "timestamp": 1589605560000,
                "value": 117691
            },
            {
                "timestamp": 1589605680000,
                "value": 4487
            },
            {
                "timestamp": 1589605800000,
                "value": 4487
            },
            {
                "timestamp": 1589605920000,
                "value": 14855
            },
            {
                "timestamp": 1589606040000,
                "value": 14855
            },
            {
                "timestamp": 1589606160000,
                "value": 14855
            },
            {
                "timestamp": 1589606520000,
                "value": 4397
            },
            {
                "timestamp": 1589606640000,
                "value": 4397
            },
            {
                "timestamp": 1589607120000,
                "value": 0
            },
            {
                "timestamp": 1589607240000,
                "value": 0
            },
            {
                "timestamp": 1589607360000,
                "value": 0
            },
            {
                "timestamp": 1589607480000,
                "value": 0
            },
            {
                "timestamp": 1589607600000,
                "value": 0
            },
            {
                "timestamp": 1589607960000,
                "value": 0
            },
            {
                "timestamp": 1589608080000,
                "value": 0
            },
            {
                "timestamp": 1589608200000,
                "value": 0
            },
            {
                "timestamp": 1589608320000,
                "value": 0
            },
            {
                "timestamp": 1589608440000,
                "value": 0
            },
            {
                "timestamp": 1589608560000,
                "value": 0
            },
            {
                "timestamp": 1589608680000,
                "value": 0
            },
            {
                "timestamp": 1589608800000,
                "value": 0
            },
            {
                "timestamp": 1589608920000,
                "value": 0
            },
            {
                "timestamp": 1589609040000,
                "value": 0
            },
            {
                "timestamp": 1589609160000,
                "value": 0
            },
            {
                "timestamp": 1589609280000,
                "value": 0
            },
            {
                "timestamp": 1589609400000,
                "value": 0
            },
            {
                "timestamp": 1589609520000,
                "value": 0
            },
            {
                "timestamp": 1589609640000,
                "value": 0
            },
            {
                "timestamp": 1589609760000,
                "value": 0
            },
            {
                "timestamp": 1589609880000,
                "value": 0
            },
            {
                "timestamp": 1589610000000,
                "value": 0
            },
            {
                "timestamp": 1589610120000,
                "value": 0
            },
            {
                "timestamp": 1589610240000,
                "value": 0
            },
            {
                "timestamp": 1589610360000,
                "value": 0
            },
            {
                "timestamp": 1589610480000,
                "value": 0
            },
            {
                "timestamp": 1589610600000,
                "value": 0
            },
            {
                "timestamp": 1589610720000,
                "value": 0
            },
            {
                "timestamp": 1589610840000,
                "value": 0
            },
            {
                "timestamp": 1589610960000,
                "value": 0
            },
            {
                "timestamp": 1589611080000,
                "value": 0
            },
            {
                "timestamp": 1589611200000,
                "value": 0
            },
            {
                "timestamp": 1589611320000,
                "value": 0
            },
            {
                "timestamp": 1589611440000,
                "value": 0
            },
            {
                "timestamp": 1589611560000,
                "value": 0
            },
            {
                "timestamp": 1589611680000,
                "value": 0
            },
            {
                "timestamp": 1589611800000,
                "value": 0
            },
            {
                "timestamp": 1589611920000,
                "value": 0
            },
            {
                "timestamp": 1589612040000,
                "value": 0
            },
            {
                "timestamp": 1589612160000,
                "value": 0
            },
            {
                "timestamp": 1589612280000,
                "value": 0
            },
            {
                "timestamp": 1589612400000,
                "value": 0
            },
            {
                "timestamp": 1589612520000,
                "value": 0
            },
            {
                "timestamp": 1589612640000,
                "value": 0
            },
            {
                "timestamp": 1589613120000,
                "value": 2619
            },
            {
                "timestamp": 1589613240000,
                "value": 2619
            },
            {
                "timestamp": 1589653080000,
                "value": 2553
            },
            {
                "timestamp": 1589653200000,
                "value": 2553
            },
            {
                "timestamp": 1589653320000,
                "value": 13742
            },
            {
                "timestamp": 1589653440000,
                "value": 13742
            },
            {
                "timestamp": 1589653560000,
                "value": 13742
            },
            {
                "timestamp": 1589653680000,
                "value": 2520
            },
            {
                "timestamp": 1589653800000,
                "value": 2520
            },
            {
                "timestamp": 1589653920000,
                "value": 2520
            },
            {
                "timestamp": 1589705760000,
                "value": 0
            },
            {
                "timestamp": 1589705880000,
                "value": 0
            },
            {
                "timestamp": 1589706000000,
                "value": 0
            },
            {
                "timestamp": 1589706120000,
                "value": 0
            },
            {
                "timestamp": 1589706240000,
                "value": 0
            },
            {
                "timestamp": 1589706360000,
                "value": 8836
            },
            {
                "timestamp": 1589706480000,
                "value": 8836
            },
            {
                "timestamp": 1589706600000,
                "value": 26562
            },
            {
                "timestamp": 1589706720000,
                "value": 26562
            },
            {
                "timestamp": 1589706840000,
                "value": 26562
            },
            {
                "timestamp": 1589706960000,
                "value": 3834
            },
            {
                "timestamp": 1589707080000,
                "value": 3834
            },
            {
                "timestamp": 1589707200000,
                "value": 83909
            },
            {
                "timestamp": 1589707320000,
                "value": 83909
            },
            {
                "timestamp": 1589707440000,
                "value": 83909
            },
            {
                "timestamp": 1589707560000,
                "value": 7963
            },
            {
                "timestamp": 1589707680000,
                "value": 7963
            },
            {
                "timestamp": 1589707800000,
                "value": 9111
            },
            {
                "timestamp": 1589707920000,
                "value": 9111
            },
            {
                "timestamp": 1589708040000,
                "value": 9111
            },
            {
                "timestamp": 1589708160000,
                "value": 8464
            },
            {
                "timestamp": 1589708280000,
                "value": 8464
            },
            {
                "timestamp": 1589781360000,
                "value": 0
            },
            {
                "timestamp": 1589781480000,
                "value": 0
            },
            {
                "timestamp": 1589781600000,
                "value": 0
            },
            {
                "timestamp": 1589781720000,
                "value": 17101
            },
            {
                "timestamp": 1589781840000,
                "value": 17101
            },
            {
                "timestamp": 1589781960000,
                "value": 7178
            },
            {
                "timestamp": 1589782080000,
                "value": 7178
            },
            {
                "timestamp": 1589782200000,
                "value": 7178
            },
            {
                "timestamp": 1589782320000,
                "value": 39974
            },
            {
                "timestamp": 1589782440000,
                "value": 39974
            },
            {
                "timestamp": 1589782560000,
                "value": 9083
            },
            {
                "timestamp": 1589782680000,
                "value": 9083
            },
            {
                "timestamp": 1589782800000,
                "value": 9083
            },
            {
                "timestamp": 1589782920000,
                "value": 18854
            },
            {
                "timestamp": 1589783040000,
                "value": 18854
            },
            {
                "timestamp": 1589783160000,
                "value": 3950
            },
            {
                "timestamp": 1589783280000,
                "value": 3950
            },
            {
                "timestamp": 1589783400000,
                "value": 3950
            },
            {
                "timestamp": 1589783520000,
                "value": 60156
            },
            {
                "timestamp": 1589783640000,
                "value": 60156
            },
            {
                "timestamp": 1589783760000,
                "value": 0
            },
            {
                "timestamp": 1589783880000,
                "value": 0
            },
            {
                "timestamp": 1589784000000,
                "value": 0
            },
            {
                "timestamp": 1589784120000,
                "value": 98750
            },
            {
                "timestamp": 1589784240000,
                "value": 98750
            },
            {
                "timestamp": 1589784360000,
                "value": 0
            },
            {
                "timestamp": 1589784480000,
                "value": 0
            },
            {
                "timestamp": 1589784600000,
                "value": 0
            },
            {
                "timestamp": 1589784720000,
                "value": 7495
            },
            {
                "timestamp": 1589784840000,
                "value": 7495
            },
            {
                "timestamp": 1589784960000,
                "value": 5542
            },
            {
                "timestamp": 1589785080000,
                "value": 5542
            },
            {
                "timestamp": 1589785200000,
                "value": 5542
            },
            {
                "timestamp": 1589785320000,
                "value": 32767
            },
            {
                "timestamp": 1589785440000,
                "value": 32767
            },
            {
                "timestamp": 1589785560000,
                "value": 7286
            },
            {
                "timestamp": 1589785680000,
                "value": 7286
            },
            {
                "timestamp": 1589785800000,
                "value": 7286
            },
            {
                "timestamp": 1589785920000,
                "value": 12984
            },
            {
                "timestamp": 1589786040000,
                "value": 12984
            },
            {
                "timestamp": 1589786160000,
                "value": 2631
            },
            {
                "timestamp": 1589786280000,
                "value": 2631
            },
            {
                "timestamp": 1589786400000,
                "value": 2631
            },
            {
                "timestamp": 1589786520000,
                "value": 12898
            },
            {
                "timestamp": 1589786640000,
                "value": 12898
            },
            {
                "timestamp": 1589786760000,
                "value": 0
            },
            {
                "timestamp": 1589786880000,
                "value": 0
            },
            {
                "timestamp": 1589787000000,
                "value": 0
            },
            {
                "timestamp": 1589787120000,
                "value": 18164
            },
            {
                "timestamp": 1589787240000,
                "value": 18164
            },
            {
                "timestamp": 1589787360000,
                "value": 2771
            },
            {
                "timestamp": 1589787480000,
                "value": 2771
            },
            {
                "timestamp": 1589787600000,
                "value": 2771
            },
            {
                "timestamp": 1589787720000,
                "value": 14792
            },
            {
                "timestamp": 1589787840000,
                "value": 14792
            },
            {
                "timestamp": 1589787960000,
                "value": 7130
            },
            {
                "timestamp": 1589788080000,
                "value": 7130
            },
            {
                "timestamp": 1589788200000,
                "value": 7130
            },
            {
                "timestamp": 1589788320000,
                "value": 105823
            },
            {
                "timestamp": 1589788440000,
                "value": 105823
            },
            {
                "timestamp": 1589788560000,
                "value": 0
            },
            {
                "timestamp": 1589788680000,
                "value": 0
            },
            {
                "timestamp": 1589788800000,
                "value": 0
            },
            {
                "timestamp": 1589788920000,
                "value": 32092
            },
            {
                "timestamp": 1589789040000,
                "value": 32092
            },
            {
                "timestamp": 1589789160000,
                "value": 0
            },
            {
                "timestamp": 1589789280000,
                "value": 0
            },
            {
                "timestamp": 1589789400000,
                "value": 0
            },
            {
                "timestamp": 1589789520000,
                "value": 15252
            },
            {
                "timestamp": 1589789640000,
                "value": 15252
            },
            {
                "timestamp": 1589789760000,
                "value": 7488
            },
            {
                "timestamp": 1589789880000,
                "value": 7488
            },
            {
                "timestamp": 1589790000000,
                "value": 7488
            },
            {
                "timestamp": 1589790120000,
                "value": 31902
            },
            {
                "timestamp": 1589790240000,
                "value": 31902
            },
            {
                "timestamp": 1589790360000,
                "value": 0
            },
            {
                "timestamp": 1589790480000,
                "value": 0
            },
            {
                "timestamp": 1589790600000,
                "value": 0
            },
            {
                "timestamp": 1589790720000,
                "value": 93369
            },
            {
                "timestamp": 1589790840000,
                "value": 93369
            },
            {
                "timestamp": 1589790960000,
                "value": 0
            },
            {
                "timestamp": 1589791080000,
                "value": 0
            },
            {
                "timestamp": 1589791200000,
                "value": 0
            },
            {
                "timestamp": 1589791320000,
                "value": 23921
            },
            {
                "timestamp": 1589791440000,
                "value": 23921
            },
            {
                "timestamp": 1589791560000,
                "value": 4610
            },
            {
                "timestamp": 1589791680000,
                "value": 4610
            },
            {
                "timestamp": 1589791800000,
                "value": 4610
            },
            {
                "timestamp": 1589791920000,
                "value": 47816
            },
            {
                "timestamp": 1589792040000,
                "value": 47816
            },
            {
                "timestamp": 1589792160000,
                "value": 7735
            },
            {
                "timestamp": 1589792280000,
                "value": 7735
            },
            {
                "timestamp": 1589792400000,
                "value": 7735
            },
            {
                "timestamp": 1589792520000,
                "value": 47674
            },
            {
                "timestamp": 1589792640000,
                "value": 47674
            },
            {
                "timestamp": 1589792760000,
                "value": 5617
            },
            {
                "timestamp": 1589792880000,
                "value": 5617
            },
            {
                "timestamp": 1589793000000,
                "value": 5617
            },
            {
                "timestamp": 1589793120000,
                "value": 8679
            },
            {
                "timestamp": 1589793240000,
                "value": 8679
            },
            {
                "timestamp": 1589793360000,
                "value": 8636
            },
            {
                "timestamp": 1589793480000,
                "value": 8636
            },
            {
                "timestamp": 1589793600000,
                "value": 8636
            },
            {
                "timestamp": 1589793720000,
                "value": 8857
            },
            {
                "timestamp": 1589793840000,
                "value": 8857
            },
            {
                "timestamp": 1589793960000,
                "value": 0
            },
            {
                "timestamp": 1589794080000,
                "value": 0
            },
            {
                "timestamp": 1589794200000,
                "value": 0
            },
            {
                "timestamp": 1589794320000,
                "value": 26484
            },
            {
                "timestamp": 1589794440000,
                "value": 26484
            },
            {
                "timestamp": 1589794560000,
                "value": 0
            },
            {
                "timestamp": 1589794680000,
                "value": 0
            },
            {
                "timestamp": 1589794800000,
                "value": 0
            },
            {
                "timestamp": 1589794920000,
                "value": 48583
            },
            {
                "timestamp": 1589795040000,
                "value": 48583
            },
            {
                "timestamp": 1589795160000,
                "value": 11910
            },
            {
                "timestamp": 1589795280000,
                "value": 11910
            },
            {
                "timestamp": 1589795400000,
                "value": 11910
            },
            {
                "timestamp": 1589795520000,
                "value": 113094
            },
            {
                "timestamp": 1589795640000,
                "value": 113094
            },
            {
                "timestamp": 1589795760000,
                "value": 6767
            },
            {
                "timestamp": 1589795880000,
                "value": 6767
            },
            {
                "timestamp": 1589796000000,
                "value": 6767
            },
            {
                "timestamp": 1589796120000,
                "value": 124816
            },
            {
                "timestamp": 1589796240000,
                "value": 124816
            },
            {
                "timestamp": 1589796360000,
                "value": 0
            },
            {
                "timestamp": 1589796480000,
                "value": 0
            },
            {
                "timestamp": 1589796600000,
                "value": 0
            },
            {
                "timestamp": 1589796720000,
                "value": 57681
            },
            {
                "timestamp": 1589796840000,
                "value": 57681
            },
            {
                "timestamp": 1589796960000,
                "value": 0
            },
            {
                "timestamp": 1589797080000,
                "value": 0
            },
            {
                "timestamp": 1589797200000,
                "value": 0
            },
            {
                "timestamp": 1589797320000,
                "value": 80948
            },
            {
                "timestamp": 1589797440000,
                "value": 80948
            },
            {
                "timestamp": 1589797560000,
                "value": 0
            },
            {
                "timestamp": 1589797680000,
                "value": 0
            },
            {
                "timestamp": 1589797800000,
                "value": 0
            },
            {
                "timestamp": 1589797920000,
                "value": 26387
            },
            {
                "timestamp": 1589798040000,
                "value": 26387
            },
            {
                "timestamp": 1589798160000,
                "value": 0
            },
            {
                "timestamp": 1589798280000,
                "value": 0
            },
            {
                "timestamp": 1589798400000,
                "value": 0
            },
            {
                "timestamp": 1589798520000,
                "value": 26068
            },
            {
                "timestamp": 1589798640000,
                "value": 26068
            },
            {
                "timestamp": 1589798760000,
                "value": 0
            },
            {
                "timestamp": 1589798880000,
                "value": 0
            },
            {
                "timestamp": 1589799000000,
                "value": 0
            },
            {
                "timestamp": 1589799120000,
                "value": 96607
            },
            {
                "timestamp": 1589799240000,
                "value": 96607
            },
            {
                "timestamp": 1589799360000,
                "value": 1979
            },
            {
                "timestamp": 1589799480000,
                "value": 1979
            },
            {
                "timestamp": 1589799600000,
                "value": 1979
            },
            {
                "timestamp": 1589799720000,
                "value": 19978
            },
            {
                "timestamp": 1589799840000,
                "value": 19978
            },
            {
                "timestamp": 1589799960000,
                "value": 5057
            },
            {
                "timestamp": 1589800080000,
                "value": 5057
            },
            {
                "timestamp": 1589800200000,
                "value": 5057
            },
            {
                "timestamp": 1589800320000,
                "value": 18425
            },
            {
                "timestamp": 1589800440000,
                "value": 18425
            },
            {
                "timestamp": 1589800560000,
                "value": 5247
            },
            {
                "timestamp": 1589800680000,
                "value": 5247
            },
            {
                "timestamp": 1589800800000,
                "value": 5247
            },
            {
                "timestamp": 1589800920000,
                "value": 39670
            },
            {
                "timestamp": 1589801040000,
                "value": 39670
            },
            {
                "timestamp": 1589801160000,
                "value": 6684
            },
            {
                "timestamp": 1589801280000,
                "value": 6684
            },
            {
                "timestamp": 1589801400000,
                "value": 6684
            },
            {
                "timestamp": 1589801520000,
                "value": 5328
            },
            {
                "timestamp": 1589801640000,
                "value": 5328
            },
            {
                "timestamp": 1589801760000,
                "value": 7155
            },
            {
                "timestamp": 1589801880000,
                "value": 7155
            },
            {
                "timestamp": 1589802000000,
                "value": 7155
            },
            {
                "timestamp": 1589802120000,
                "value": 5653
            },
            {
                "timestamp": 1589802240000,
                "value": 5653
            },
            {
                "timestamp": 1589802360000,
                "value": 0
            },
            {
                "timestamp": 1589802480000,
                "value": 0
            },
            {
                "timestamp": 1589802600000,
                "value": 0
            },
            {
                "timestamp": 1589802720000,
                "value": 82627
            },
            {
                "timestamp": 1589802840000,
                "value": 82627
            },
            {
                "timestamp": 1589802960000,
                "value": 6058
            },
            {
                "timestamp": 1589803080000,
                "value": 6058
            },
            {
                "timestamp": 1589803200000,
                "value": 6058
            },
            {
                "timestamp": 1589803320000,
                "value": 52149
            },
            {
                "timestamp": 1589803440000,
                "value": 52149
            },
            {
                "timestamp": 1589803560000,
                "value": 52149
            },
            {
                "timestamp": 1589805000000,
                "value": 1719
            },
            {
                "timestamp": 1589805120000,
                "value": 1719
            },
            {
                "timestamp": 1589805240000,
                "value": 0
            },
            {
                "timestamp": 1589805360000,
                "value": 0
            },
            {
                "timestamp": 1589805480000,
                "value": 0
            },
            {
                "timestamp": 1589805600000,
                "value": 4536
            },
            {
                "timestamp": 1589805720000,
                "value": 4536
            },
            {
                "timestamp": 1589805840000,
                "value": 4536
            }
        ]
    },
    {
        "tags": {
            "__name__": "zbio_podcpu",
            "ns": "zbio",
            "pod": "zbio-broker-group1-2"
        },
        "metrics": [
            {
                "timestamp": 1589599920000,
                "value": 305027
            },
            {
                "timestamp": 1589600040000,
                "value": 305027
            },
            {
                "timestamp": 1589600160000,
                "value": 2480
            },
            {
                "timestamp": 1589600280000,
                "value": 2480
            },
            {
                "timestamp": 1589600400000,
                "value": 2480
            },
            {
                "timestamp": 1589600640000,
                "value": 2812
            },
            {
                "timestamp": 1589600760000,
                "value": 2812
            },
            {
                "timestamp": 1589600880000,
                "value": 2812
            },
            {
                "timestamp": 1589601000000,
                "value": 8322
            },
            {
                "timestamp": 1589601120000,
                "value": 8322
            },
            {
                "timestamp": 1589601240000,
                "value": 3566
            },
            {
                "timestamp": 1589601360000,
                "value": 3566
            },
            {
                "timestamp": 1589601480000,
                "value": 3566
            },
            {
                "timestamp": 1589601600000,
                "value": 74070
            },
            {
                "timestamp": 1589601720000,
                "value": 74070
            },
            {
                "timestamp": 1589601840000,
                "value": 3822
            },
            {
                "timestamp": 1589601960000,
                "value": 3822
            },
            {
                "timestamp": 1589602080000,
                "value": 3822
            },
            {
                "timestamp": 1589602200000,
                "value": 24593
            },
            {
                "timestamp": 1589602320000,
                "value": 24593
            },
            {
                "timestamp": 1589602440000,
                "value": 0
            },
            {
                "timestamp": 1589602560000,
                "value": 0
            },
            {
                "timestamp": 1589602680000,
                "value": 0
            },
            {
                "timestamp": 1589602800000,
                "value": 15917
            },
            {
                "timestamp": 1589602920000,
                "value": 15917
            },
            {
                "timestamp": 1589603040000,
                "value": 0
            },
            {
                "timestamp": 1589603160000,
                "value": 0
            },
            {
                "timestamp": 1589603280000,
                "value": 0
            },
            {
                "timestamp": 1589603880000,
                "value": 0
            },
            {
                "timestamp": 1589604000000,
                "value": 0
            },
            {
                "timestamp": 1589604120000,
                "value": 0
            },
            {
                "timestamp": 1589605080000,
                "value": 14136
            },
            {
                "timestamp": 1589605200000,
                "value": 14136
            },
            {
                "timestamp": 1589605320000,
                "value": 117691
            },
            {
                "timestamp": 1589605440000,
                "value": 117691
            },
            {
                "timestamp": 1589605560000,
                "value": 117691
            },
            {
                "timestamp": 1589605680000,
                "value": 4487
            },
            {
                "timestamp": 1589605800000,
                "value": 4487
            },
            {
                "timestamp": 1589605920000,
                "value": 14855
            },
            {
                "timestamp": 1589606040000,
                "value": 14855
            },
            {
                "timestamp": 1589606160000,
                "value": 14855
            },
            {
                "timestamp": 1589606520000,
                "value": 4397
            },
            {
                "timestamp": 1589606640000,
                "value": 4397
            },
            {
                "timestamp": 1589607120000,
                "value": 0
            },
            {
                "timestamp": 1589607240000,
                "value": 0
            },
            {
                "timestamp": 1589607360000,
                "value": 0
            },
            {
                "timestamp": 1589607480000,
                "value": 0
            },
            {
                "timestamp": 1589607600000,
                "value": 0
            },
            {
                "timestamp": 1589607960000,
                "value": 0
            },
            {
                "timestamp": 1589608080000,
                "value": 0
            },
            {
                "timestamp": 1589608200000,
                "value": 0
            },
            {
                "timestamp": 1589608320000,
                "value": 0
            },
            {
                "timestamp": 1589608440000,
                "value": 0
            },
            {
                "timestamp": 1589608560000,
                "value": 0
            },
            {
                "timestamp": 1589608680000,
                "value": 0
            },
            {
                "timestamp": 1589608800000,
                "value": 0
            },
            {
                "timestamp": 1589608920000,
                "value": 0
            },
            {
                "timestamp": 1589609040000,
                "value": 0
            },
            {
                "timestamp": 1589609160000,
                "value": 0
            },
            {
                "timestamp": 1589609280000,
                "value": 0
            },
            {
                "timestamp": 1589609400000,
                "value": 0
            },
            {
                "timestamp": 1589609520000,
                "value": 0
            },
            {
                "timestamp": 1589609640000,
                "value": 0
            },
            {
                "timestamp": 1589609760000,
                "value": 0
            },
            {
                "timestamp": 1589609880000,
                "value": 0
            },
            {
                "timestamp": 1589610000000,
                "value": 0
            },
            {
                "timestamp": 1589610120000,
                "value": 0
            },
            {
                "timestamp": 1589610240000,
                "value": 0
            },
            {
                "timestamp": 1589610360000,
                "value": 0
            },
            {
                "timestamp": 1589610480000,
                "value": 0
            },
            {
                "timestamp": 1589610600000,
                "value": 0
            },
            {
                "timestamp": 1589610720000,
                "value": 0
            },
            {
                "timestamp": 1589610840000,
                "value": 0
            },
            {
                "timestamp": 1589610960000,
                "value": 0
            },
            {
                "timestamp": 1589611080000,
                "value": 0
            },
            {
                "timestamp": 1589611200000,
                "value": 0
            },
            {
                "timestamp": 1589611320000,
                "value": 0
            },
            {
                "timestamp": 1589611440000,
                "value": 0
            },
            {
                "timestamp": 1589611560000,
                "value": 0
            },
            {
                "timestamp": 1589611680000,
                "value": 0
            },
            {
                "timestamp": 1589611800000,
                "value": 0
            },
            {
                "timestamp": 1589611920000,
                "value": 0
            },
            {
                "timestamp": 1589612040000,
                "value": 0
            },
            {
                "timestamp": 1589612160000,
                "value": 0
            },
            {
                "timestamp": 1589612280000,
                "value": 0
            },
            {
                "timestamp": 1589612400000,
                "value": 0
            },
            {
                "timestamp": 1589612520000,
                "value": 0
            },
            {
                "timestamp": 1589612640000,
                "value": 0
            },
            {
                "timestamp": 1589613120000,
                "value": 2619
            },
            {
                "timestamp": 1589613240000,
                "value": 2619
            },
            {
                "timestamp": 1589653080000,
                "value": 2553
            },
            {
                "timestamp": 1589653200000,
                "value": 2553
            },
            {
                "timestamp": 1589653320000,
                "value": 13742
            },
            {
                "timestamp": 1589653440000,
                "value": 13742
            },
            {
                "timestamp": 1589653560000,
                "value": 13742
            },
            {
                "timestamp": 1589653680000,
                "value": 2520
            },
            {
                "timestamp": 1589653800000,
                "value": 2520
            },
            {
                "timestamp": 1589653920000,
                "value": 2520
            },
            {
                "timestamp": 1589705760000,
                "value": 0
            },
            {
                "timestamp": 1589705880000,
                "value": 0
            },
            {
                "timestamp": 1589706000000,
                "value": 0
            },
            {
                "timestamp": 1589706120000,
                "value": 0
            },
            {
                "timestamp": 1589706240000,
                "value": 0
            },
            {
                "timestamp": 1589706360000,
                "value": 8836
            },
            {
                "timestamp": 1589706480000,
                "value": 8836
            },
            {
                "timestamp": 1589706600000,
                "value": 26562
            },
            {
                "timestamp": 1589706720000,
                "value": 26562
            },
            {
                "timestamp": 1589706840000,
                "value": 26562
            },
            {
                "timestamp": 1589706960000,
                "value": 3834
            },
            {
                "timestamp": 1589707080000,
                "value": 3834
            },
            {
                "timestamp": 1589707200000,
                "value": 83909
            },
            {
                "timestamp": 1589707320000,
                "value": 83909
            },
            {
                "timestamp": 1589707440000,
                "value": 83909
            },
            {
                "timestamp": 1589707560000,
                "value": 7963
            },
            {
                "timestamp": 1589707680000,
                "value": 7963
            },
            {
                "timestamp": 1589707800000,
                "value": 9111
            },
            {
                "timestamp": 1589707920000,
                "value": 9111
            },
            {
                "timestamp": 1589708040000,
                "value": 9111
            },
            {
                "timestamp": 1589708160000,
                "value": 8464
            },
            {
                "timestamp": 1589708280000,
                "value": 8464
            },
            {
                "timestamp": 1589781360000,
                "value": 0
            },
            {
                "timestamp": 1589781480000,
                "value": 0
            },
            {
                "timestamp": 1589781600000,
                "value": 0
            },
            {
                "timestamp": 1589781720000,
                "value": 17101
            },
            {
                "timestamp": 1589781840000,
                "value": 17101
            },
            {
                "timestamp": 1589781960000,
                "value": 7178
            },
            {
                "timestamp": 1589782080000,
                "value": 7178
            },
            {
                "timestamp": 1589782200000,
                "value": 7178
            },
            {
                "timestamp": 1589782320000,
                "value": 39974
            },
            {
                "timestamp": 1589782440000,
                "value": 39974
            },
            {
                "timestamp": 1589782560000,
                "value": 9083
            },
            {
                "timestamp": 1589782680000,
                "value": 9083
            },
            {
                "timestamp": 1589782800000,
                "value": 9083
            },
            {
                "timestamp": 1589782920000,
                "value": 18854
            },
            {
                "timestamp": 1589783040000,
                "value": 18854
            },
            {
                "timestamp": 1589783160000,
                "value": 3950
            },
            {
                "timestamp": 1589783280000,
                "value": 3950
            },
            {
                "timestamp": 1589783400000,
                "value": 3950
            },
            {
                "timestamp": 1589783520000,
                "value": 60156
            },
            {
                "timestamp": 1589783640000,
                "value": 60156
            },
            {
                "timestamp": 1589783760000,
                "value": 0
            },
            {
                "timestamp": 1589783880000,
                "value": 0
            },
            {
                "timestamp": 1589784000000,
                "value": 0
            },
            {
                "timestamp": 1589784120000,
                "value": 98750
            },
            {
                "timestamp": 1589784240000,
                "value": 98750
            },
            {
                "timestamp": 1589784360000,
                "value": 0
            },
            {
                "timestamp": 1589784480000,
                "value": 0
            },
            {
                "timestamp": 1589784600000,
                "value": 0
            },
            {
                "timestamp": 1589784720000,
                "value": 7495
            },
            {
                "timestamp": 1589784840000,
                "value": 7495
            },
            {
                "timestamp": 1589784960000,
                "value": 5542
            },
            {
                "timestamp": 1589785080000,
                "value": 5542
            },
            {
                "timestamp": 1589785200000,
                "value": 5542
            },
            {
                "timestamp": 1589785320000,
                "value": 32767
            },
            {
                "timestamp": 1589785440000,
                "value": 32767
            },
            {
                "timestamp": 1589785560000,
                "value": 7286
            },
            {
                "timestamp": 1589785680000,
                "value": 7286
            },
            {
                "timestamp": 1589785800000,
                "value": 7286
            },
            {
                "timestamp": 1589785920000,
                "value": 12984
            },
            {
                "timestamp": 1589786040000,
                "value": 12984
            },
            {
                "timestamp": 1589786160000,
                "value": 2631
            },
            {
                "timestamp": 1589786280000,
                "value": 2631
            },
            {
                "timestamp": 1589786400000,
                "value": 2631
            },
            {
                "timestamp": 1589786520000,
                "value": 12898
            },
            {
                "timestamp": 1589786640000,
                "value": 12898
            },
            {
                "timestamp": 1589786760000,
                "value": 0
            },
            {
                "timestamp": 1589786880000,
                "value": 0
            },
            {
                "timestamp": 1589787000000,
                "value": 0
            },
            {
                "timestamp": 1589787120000,
                "value": 18164
            },
            {
                "timestamp": 1589787240000,
                "value": 18164
            },
            {
                "timestamp": 1589787360000,
                "value": 2771
            },
            {
                "timestamp": 1589787480000,
                "value": 2771
            },
            {
                "timestamp": 1589787600000,
                "value": 2771
            },
            {
                "timestamp": 1589787720000,
                "value": 14792
            },
            {
                "timestamp": 1589787840000,
                "value": 14792
            },
            {
                "timestamp": 1589787960000,
                "value": 7130
            },
            {
                "timestamp": 1589788080000,
                "value": 7130
            },
            {
                "timestamp": 1589788200000,
                "value": 7130
            },
            {
                "timestamp": 1589788320000,
                "value": 105823
            },
            {
                "timestamp": 1589788440000,
                "value": 105823
            },
            {
                "timestamp": 1589788560000,
                "value": 0
            },
            {
                "timestamp": 1589788680000,
                "value": 0
            },
            {
                "timestamp": 1589788800000,
                "value": 0
            },
            {
                "timestamp": 1589788920000,
                "value": 32092
            },
            {
                "timestamp": 1589789040000,
                "value": 32092
            },
            {
                "timestamp": 1589789160000,
                "value": 0
            },
            {
                "timestamp": 1589789280000,
                "value": 0
            },
            {
                "timestamp": 1589789400000,
                "value": 0
            },
            {
                "timestamp": 1589789520000,
                "value": 15252
            },
            {
                "timestamp": 1589789640000,
                "value": 15252
            },
            {
                "timestamp": 1589789760000,
                "value": 7488
            },
            {
                "timestamp": 1589789880000,
                "value": 7488
            },
            {
                "timestamp": 1589790000000,
                "value": 7488
            },
            {
                "timestamp": 1589790120000,
                "value": 31902
            },
            {
                "timestamp": 1589790240000,
                "value": 31902
            },
            {
                "timestamp": 1589790360000,
                "value": 0
            },
            {
                "timestamp": 1589790480000,
                "value": 0
            },
            {
                "timestamp": 1589790600000,
                "value": 0
            },
            {
                "timestamp": 1589790720000,
                "value": 93369
            },
            {
                "timestamp": 1589790840000,
                "value": 93369
            },
            {
                "timestamp": 1589790960000,
                "value": 0
            },
            {
                "timestamp": 1589791080000,
                "value": 0
            },
            {
                "timestamp": 1589791200000,
                "value": 0
            },
            {
                "timestamp": 1589791320000,
                "value": 23921
            },
            {
                "timestamp": 1589791440000,
                "value": 23921
            },
            {
                "timestamp": 1589791560000,
                "value": 4610
            },
            {
                "timestamp": 1589791680000,
                "value": 4610
            },
            {
                "timestamp": 1589791800000,
                "value": 4610
            },
            {
                "timestamp": 1589791920000,
                "value": 47816
            },
            {
                "timestamp": 1589792040000,
                "value": 47816
            },
            {
                "timestamp": 1589792160000,
                "value": 7735
            },
            {
                "timestamp": 1589792280000,
                "value": 7735
            },
            {
                "timestamp": 1589792400000,
                "value": 7735
            },
            {
                "timestamp": 1589792520000,
                "value": 47674
            },
            {
                "timestamp": 1589792640000,
                "value": 47674
            },
            {
                "timestamp": 1589792760000,
                "value": 5617
            },
            {
                "timestamp": 1589792880000,
                "value": 5617
            },
            {
                "timestamp": 1589793000000,
                "value": 5617
            },
            {
                "timestamp": 1589793120000,
                "value": 8679
            },
            {
                "timestamp": 1589793240000,
                "value": 8679
            },
            {
                "timestamp": 1589793360000,
                "value": 8636
            },
            {
                "timestamp": 1589793480000,
                "value": 8636
            },
            {
                "timestamp": 1589793600000,
                "value": 8636
            },
            {
                "timestamp": 1589793720000,
                "value": 8857
            },
            {
                "timestamp": 1589793840000,
                "value": 8857
            },
            {
                "timestamp": 1589793960000,
                "value": 0
            },
            {
                "timestamp": 1589794080000,
                "value": 0
            },
            {
                "timestamp": 1589794200000,
                "value": 0
            },
            {
                "timestamp": 1589794320000,
                "value": 26484
            },
            {
                "timestamp": 1589794440000,
                "value": 26484
            },
            {
                "timestamp": 1589794560000,
                "value": 0
            },
            {
                "timestamp": 1589794680000,
                "value": 0
            },
            {
                "timestamp": 1589794800000,
                "value": 0
            },
            {
                "timestamp": 1589794920000,
                "value": 48583
            },
            {
                "timestamp": 1589795040000,
                "value": 48583
            },
            {
                "timestamp": 1589795160000,
                "value": 11910
            },
            {
                "timestamp": 1589795280000,
                "value": 11910
            },
            {
                "timestamp": 1589795400000,
                "value": 11910
            },
            {
                "timestamp": 1589795520000,
                "value": 113094
            },
            {
                "timestamp": 1589795640000,
                "value": 113094
            },
            {
                "timestamp": 1589795760000,
                "value": 6767
            },
            {
                "timestamp": 1589795880000,
                "value": 6767
            },
            {
                "timestamp": 1589796000000,
                "value": 6767
            },
            {
                "timestamp": 1589796120000,
                "value": 124816
            },
            {
                "timestamp": 1589796240000,
                "value": 124816
            },
            {
                "timestamp": 1589796360000,
                "value": 0
            },
            {
                "timestamp": 1589796480000,
                "value": 0
            },
            {
                "timestamp": 1589796600000,
                "value": 0
            },
            {
                "timestamp": 1589796720000,
                "value": 57681
            },
            {
                "timestamp": 1589796840000,
                "value": 57681
            },
            {
                "timestamp": 1589796960000,
                "value": 0
            },
            {
                "timestamp": 1589797080000,
                "value": 0
            },
            {
                "timestamp": 1589797200000,
                "value": 0
            },
            {
                "timestamp": 1589797320000,
                "value": 80948
            },
            {
                "timestamp": 1589797440000,
                "value": 80948
            },
            {
                "timestamp": 1589797560000,
                "value": 0
            },
            {
                "timestamp": 1589797680000,
                "value": 0
            },
            {
                "timestamp": 1589797800000,
                "value": 0
            },
            {
                "timestamp": 1589797920000,
                "value": 26387
            },
            {
                "timestamp": 1589798040000,
                "value": 26387
            },
            {
                "timestamp": 1589798160000,
                "value": 0
            },
            {
                "timestamp": 1589798280000,
                "value": 0
            },
            {
                "timestamp": 1589798400000,
                "value": 0
            },
            {
                "timestamp": 1589798520000,
                "value": 26068
            },
            {
                "timestamp": 1589798640000,
                "value": 26068
            },
            {
                "timestamp": 1589798760000,
                "value": 0
            },
            {
                "timestamp": 1589798880000,
                "value": 0
            },
            {
                "timestamp": 1589799000000,
                "value": 0
            },
            {
                "timestamp": 1589799120000,
                "value": 96607
            },
            {
                "timestamp": 1589799240000,
                "value": 96607
            },
            {
                "timestamp": 1589799360000,
                "value": 1979
            },
            {
                "timestamp": 1589799480000,
                "value": 1979
            },
            {
                "timestamp": 1589799600000,
                "value": 1979
            },
            {
                "timestamp": 1589799720000,
                "value": 19978
            },
            {
                "timestamp": 1589799840000,
                "value": 19978
            },
            {
                "timestamp": 1589799960000,
                "value": 5057
            },
            {
                "timestamp": 1589800080000,
                "value": 5057
            },
            {
                "timestamp": 1589800200000,
                "value": 5057
            },
            {
                "timestamp": 1589800320000,
                "value": 18425
            },
            {
                "timestamp": 1589800440000,
                "value": 18425
            },
            {
                "timestamp": 1589800560000,
                "value": 5247
            },
            {
                "timestamp": 1589800680000,
                "value": 5247
            },
            {
                "timestamp": 1589800800000,
                "value": 5247
            },
            {
                "timestamp": 1589800920000,
                "value": 39670
            },
            {
                "timestamp": 1589801040000,
                "value": 39670
            },
            {
                "timestamp": 1589801160000,
                "value": 6684
            },
            {
                "timestamp": 1589801280000,
                "value": 6684
            },
            {
                "timestamp": 1589801400000,
                "value": 6684
            },
            {
                "timestamp": 1589801520000,
                "value": 5328
            },
            {
                "timestamp": 1589801640000,
                "value": 5328
            },
            {
                "timestamp": 1589801760000,
                "value": 7155
            },
            {
                "timestamp": 1589801880000,
                "value": 7155
            },
            {
                "timestamp": 1589802000000,
                "value": 7155
            },
            {
                "timestamp": 1589802120000,
                "value": 5653
            },
            {
                "timestamp": 1589802240000,
                "value": 5653
            },
            {
                "timestamp": 1589802360000,
                "value": 0
            },
            {
                "timestamp": 1589802480000,
                "value": 0
            },
            {
                "timestamp": 1589802600000,
                "value": 0
            },
            {
                "timestamp": 1589802720000,
                "value": 82627
            },
            {
                "timestamp": 1589802840000,
                "value": 82627
            },
            {
                "timestamp": 1589802960000,
                "value": 6058
            },
            {
                "timestamp": 1589803080000,
                "value": 6058
            },
            {
                "timestamp": 1589803200000,
                "value": 6058
            },
            {
                "timestamp": 1589803320000,
                "value": 52149
            },
            {
                "timestamp": 1589803440000,
                "value": 52149
            },
            {
                "timestamp": 1589803560000,
                "value": 52149
            },
            {
                "timestamp": 1589805000000,
                "value": 1719
            },
            {
                "timestamp": 1589805120000,
                "value": 1719
            },
            {
                "timestamp": 1589805240000,
                "value": 0
            },
            {
                "timestamp": 1589805360000,
                "value": 0
            },
            {
                "timestamp": 1589805480000,
                "value": 0
            },
            {
                "timestamp": 1589805600000,
                "value": 4536
            },
            {
                "timestamp": 1589805720000,
                "value": 4536
            },
            {
                "timestamp": 1589805840000,
                "value": 4536
            }
        ]
    },
  
  ]

var nested_data = d3.nest()
.key(function(d) { return d.tags.pod; })
.entries(data);

draw(nested_data);

// Create invisible rect for mouse tracking
svg.append("rect")
    .attr("width", width)
    .attr("height", height)                                    
    .attr("x", 0) 
    .attr("y", 0)
    .attr("id", "mouse-tracker")
    .style("fill", "white"); 

//for slider part-----------------------------------------------------------------------------------
  
var context = svg.append("g") // Brushing context box container
    .attr("transform", "translate(" + 0 + "," + 410 + ")")
    .attr("class", "context");

//append clip path for lines plotted, hiding those part out of bounds
svg.append("defs")
  .append("clipPath") 
    .attr("id", "clip")
    .append("rect")
    .attr("width", width)
    .attr("height", height); 

//end slider part----------------------------------------------------------------------------------- 

function draw(data) {  
// d3.tsv("data.tsv", function(error, data) {
  console.log(data)
  // unable to get all pods name on the same level.
  color.domain(d3.keys(data[0].pods).filter(function(key) { // Set the domain of the color ordinal scale to be all the csv headers except "date", matching a color to an issue
  console.log(key)  
  return key !== "date"; 
  }));

  data.forEach(function(item) { // Make every date in the csv data a javascript date object format
    console.log(item)
    item.values[0].metrics.forEach(function(d){
        d.timestamp = d.values
    }); 
  });

  var categories = color.domain().map(function(name) { // Nest the data into an array of objects with new keys

    return {
      name: name, // "name": the csv headers except date
      values: data.map(function(d) { // "values": which has an array of the dates and ratings
        return {
          date: d.date, 
          rating: +(d[name]),
          };
      }),
      visible: (name === "zbio-broker-group1-1" ? true : false) // "visible": all false except for economy which is true.
    };
  });

  xScale.domain(d3.extent(data, function(d) { return d.date; })); // extent = highest and lowest points, domain is data, range is bouding box

  yScale.domain([0, 100
    //d3.max(categories, function(c) { return d3.max(c.values, function(v) { return v.rating; }); })
  ]);

  xScale2.domain(xScale.domain()); // Setting a duplicate xdomain for brushing reference later
 
 //for slider part-----------------------------------------------------------------------------------

 var brush = d3.svg.brush()//for slider bar at the bottom
    .x(xScale2) 
    .on("brush", brushed);

  context.append("g") // Create brushing xAxis
      .attr("class", "x axis1")
      .attr("transform", "translate(0," + height2 + ")")
      .call(xAxis2);

  var contextArea = d3.svg.area() // Set attributes for area chart in brushing context graph
    .interpolate("monotone")
    .x(function(d) { return xScale2(d.date); }) // x is scaled to xScale2
    .y0(height2) // Bottom line begins at height2 (area chart not inverted) 
    .y1(0); // Top line of area, 0 (area chart not inverted)

  //plot the rect as the bar at the bottom
  context.append("path") // Path is created using svg.area details
    .attr("class", "area")
    .attr("d", contextArea(categories[0].values)) // pass first categories data .values to area path generator  //values -> value
    .attr("fill", "#F1F1F2");
    
  //append the brush for the selection of subsection  
  context.append("g")
    .attr("class", "x brush")
    .call(brush)
    .selectAll("rect")
    .attr("height", height2) // Make brush rects same height 
      .attr("fill", "#E6E7E8");  
  //end slider part-----------------------------------------------------------------------------------

  // draw line graph
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("x", -10)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Issues Rating");

  var issue = svg.selectAll(".issue")
      .data(categories) // Select nested data and append to new svg group elements
    .enter().append("g")
      .attr("class", "issue");   

  issue.append("path")
      .attr("class", "line")
      .style("pointer-events", "none") // Stop line interferring with cursor
      .attr("id", function(d) {
        return "line-" + d.name.replace(" ", "").replace("/", ""); // Give line id of line-(insert issue name, with any spaces replaced with no spaces)
      })
      .attr("d", function(d) { 
        return d.visible ? line(d.values) : null; // If array key "visible" = true then draw line, if not then don't 
      })
      .attr("clip-path", "url(#clip)")//use clip path to make irrelevant part invisible
      .style("stroke", function(d) { return color(d.name); });

  // draw legend
  var legendSpace = 450 / categories.length; // 450/number of issues (ex. 40)    

  issue.append("rect")
      .attr("width", 10)
      .attr("height", 10)                                    
      .attr("x", width + (margin.right/3) - 15) 
      .attr("y", function (d, i) { return (legendSpace)+i*(legendSpace) - 8; })  // spacing
      .attr("fill",function(d) {
        return d.visible ? color(d.name) : "#F1F1F2"; // If array key "visible" = true then color rect, if not then make it grey 
      })
      .attr("class", "legend-box")

      .on("click", function(d){ // On click make d.visible 
        d.visible = !d.visible; // If array key for this data selection is "visible" = true then make it false, if false then make it true

        maxY = findMaxY(categories); // Find max Y rating value categories data with "visible"; true
        yScale.domain([0,maxY]); // Redefine yAxis domain based on highest y value of categories data with "visible"; true
        svg.select(".y.axis")
          .transition()
          .call(yAxis);   

        issue.select("path")
          .transition()
          .attr("d", function(d){
            return d.visible ? line(d.values) : null; // If d.visible is true then draw line for this d selection
          })

        issue.select("rect")
          .transition()
          .attr("fill", function(d) {
          return d.visible ? color(d.name) : "#F1F1F2";
        });
      })

      .on("mouseover", function(d){

        d3.select(this)
          .transition()
          .attr("fill", function(d) { return color(d.name); });

        d3.select("#line-" + d.name.replace(" ", "").replace("/", ""))
          .transition()
          .style("stroke-width", 2.5);  
      })

      .on("mouseout", function(d){

        d3.select(this)
          .transition()
          .attr("fill", function(d) {
          return d.visible ? color(d.name) : "#F1F1F2";});

        d3.select("#line-" + d.name.replace(" ", "").replace("/", ""))
          .transition()
          .style("stroke-width", 1.5);
      })
      
  issue.append("text")
      .attr("x", width + (margin.right/3)) 
      .attr("y", function (d, i) { return (legendSpace)+i*(legendSpace); })  // (return (11.25/2 =) 5.625) + i * (5.625) 
      .text(function(d) { return d.name; }); 

  // Hover line 
  var hoverLineGroup = svg.append("g") 
            .attr("class", "hover-line");

  var hoverLine = hoverLineGroup // Create line with basic attributes
        .append("line")
            .attr("id", "hover-line")
            .attr("x1", 10).attr("x2", 10) 
            .attr("y1", 0).attr("y2", height + 10)
            .style("pointer-events", "none") // Stop line interferring with cursor
            .style("opacity", 1e-6); // Set opacity to zero 

  var hoverDate = hoverLineGroup
        .append('text')
            .attr("class", "hover-text")
            .attr("y", height - (height-40)) // hover date text position
            .attr("x", width - 150) // hover date text position
            .style("fill", "#E6E7E8");

  var columnNames = d3.keys(data[0]) //grab the key values from your first data row
                                     //these are the same as your column names
                  .slice(1); //remove the first column name (`date`);

  var focus = issue.select("g") // create group elements to house tooltip text
      .data(columnNames) // bind each column name date to each g element
    .enter().append("g") //create one <g> for each columnName
      .attr("class", "focus"); 

  focus.append("text") // http://stackoverflow.com/questions/22064083/d3-js-multi-series-chart-with-y-value-tracking
        .attr("class", "tooltip")
        .attr("x", width + 20) // position tooltips  
        .attr("y", function (d, i) { return (legendSpace)+i*(legendSpace); }); // (return (11.25/2 =) 5.625) + i * (5.625) // position tooltips       

  // Add mouseover events for hover line.
  d3.select("#mouse-tracker") // select chart plot background rect #mouse-tracker
  .on("mousemove", mousemove) // on mousemove activate mousemove function defined below
  .on("mouseout", function() {
      hoverDate
          .text(null) // on mouseout remove text for hover date

      d3.select("#hover-line")
          .style("opacity", 1e-6); // On mouse out making line invisible
  });

  function mousemove() { 
      var mouse_x = d3.mouse(this)[0]; // Finding mouse x position on rect
      var graph_x = xScale.invert(mouse_x); // 

      //var mouse_y = d3.mouse(this)[1]; // Finding mouse y position on rect
      //var graph_y = yScale.invert(mouse_y);
      //console.log(graph_x);
      
      var format = d3.time.format('%b %Y'); // Format hover date text to show three letter month and full year
      
      hoverDate.text(format(graph_x)); // scale mouse position to xScale date and format it to show month and year
      
      d3.select("#hover-line") // select hover-line and changing attributes to mouse position
          .attr("x1", mouse_x) 
          .attr("x2", mouse_x)
          .style("opacity", 1); // Making line visible

      // Legend tooltips // http://www.d3noob.org/2014/07/my-favourite-tooltip-method-for-line.html

      var x0 = xScale.invert(d3.mouse(this)[0]), /* d3.mouse(this)[0] returns the x position on the screen of the mouse. xScale.invert function is reversing the process that we use to map the domain (date) to range (position on screen). So it takes the position on the screen and converts it into an equivalent date! */
      i = bisectDate(data, x0, 1), // use our bisectDate function that we declared earlier to find the index of our data array that is close to the mouse cursor
      /*It takes our data array and the date corresponding to the position of or mouse cursor and returns the index number of the data array which has a date that is higher than the cursor position.*/
      d0 = data[i - 1],
      d1 = data[i],
      /*d0 is the combination of date and rating that is in the data array at the index to the left of the cursor and d1 is the combination of date and close that is in the data array at the index to the right of the cursor. In other words we now have two variables that know the value and date above and below the date that corresponds to the position of the cursor.*/
      d = x0 - d0.date > d1.date - x0 ? d1 : d0;
      /*The final line in this segment declares a new array d that is represents the date and close combination that is closest to the cursor. It is using the magic JavaScript short hand for an if statement that is essentially saying if the distance between the mouse cursor and the date and close combination on the left is greater than the distance between the mouse cursor and the date and close combination on the right then d is an array of the date and close on the right of the cursor (d1). Otherwise d is an array of the date and close on the left of the cursor (d0).*/

      //d is now the data row for the date closest to the mouse position

      focus.select("text").text(function(columnName){
         //because you didn't explictly set any data on the <text>
         //elements, each one inherits the data from the focus <g>

         return (d[columnName]);
      });
  }; 

  //for brusher of the slider bar at the bottom
  function brushed() {

    xScale.domain(brush.empty() ? xScale2.domain() : brush.extent()); // If brush is empty then reset the Xscale domain to default, if not then make it the brush extent 

    svg.select(".x.axis") // replot xAxis with transition when brush used
          .transition()
          .call(xAxis);

    maxY = findMaxY(categories); // Find max Y rating value categories data with "visible"; true
    yScale.domain([0,maxY]); // Redefine yAxis domain based on highest y value of categories data with "visible"; true
    
    svg.select(".y.axis") // Redraw yAxis
      .transition()
      .call(yAxis);   

    issue.select("path") // Redraw lines based on brush xAxis scale and domain
      .transition()
      .attr("d", function(d){
          return d.visible ? line(d.values) : null; // If d.visible is true then draw line for this d selection
      });
    
  };      

// }); // End Data callback function
} 
  function findMaxY(data){  // Define function "findMaxY"
    var maxYValues = data.map(function(d) { 
      if (d.visible){
        return d3.max(d.values, function(value) { // Return max rating value
          return value.rating; })
      }
    });
    return d3.max(maxYValues);
  }
  

</script>
</html>


